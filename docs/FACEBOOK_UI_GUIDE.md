# Facebook 管理UI使用指南

本文档详细介绍 AI CMS 中 Facebook 管理模块的所有UI功能和使用方法。

## 访问路径

管理界面位于：`/admin/facebook`

需要权限：`ADMIN`、`EDITOR` 或 `AUTHOR` 角色

## 界面布局

Facebook 管理页面包含以下四个主要模块：

### 1️⃣ Connected Facebook Pages (已连接的Facebook页面)

#### 功能概述
管理所有已连接的 Facebook 企业页面，用于官方内容发布。

#### 界面元素

**页面列表显示**：
- 📄 **页面图标** - 蓝色Facebook图标（启用）或灰色图标（禁用）
- **页面名称** - 显著展示
- **页面信息**：
  - Page ID（Facebook页面ID）
  - 发帖数量统计
  - Token过期时间

**操作按钮**：
- 🔵 **Enable/Disable** - 启用或禁用该页面
- 🗑️ **Delete** - 删除页面连接

**顶部工具栏**：
- 显示已连接页面总数
- **Connect Facebook Page** 按钮 - 连接新页面

#### 使用流程

1. **连接新页面**：
   ```
   点击 "Connect Facebook Page"
   → Facebook授权登录
   → 选择要连接的页面
   → 完成连接
   ```

2. **管理页面状态**：
   - 点击 "Disable" 暂时停用某个页面（不删除）
   - 点击 "Enable" 重新启用

3. **删除页面**：
   - 点击删除按钮
   - 确认删除操作
   - 页面连接将被永久移除

#### 状态指示器
- ✅ **绿色徽章** - 页面已启用
- ⚠️ **黄色徽章** - Token即将过期
- ⏰ **过期提示** - 显示Token过期日期

---

### 2️⃣ Connected Facebook Groups (已连接的Facebook小组)

#### 功能概述
管理已加入的 Facebook 小组，追踪发帖频率，避免过度营销。

#### 界面元素

**小组列表显示**：
- 👥 **小组图标** - 蓝色用户组图标（启用）或灰色图标（禁用）
- **小组名称** - 显著展示
- **隐私级别徽章**：
  - 🟢 **PUBLIC** - 公开小组（绿色）
  - 🟡 **CLOSED** - 私密小组（黄色）
  - 🔴 **SECRET** - 秘密小组（红色）
- **小组描述** - 如果有的话，显示简短描述（最多2行）

**详细信息**：
- 👥 成员数量（例如：1,234 members）
- 📝 发帖数量统计
- ⏰ **最后发帖时间**（核心功能）：
  - ✅ 已发帖：显示 "Last posted: 2 hours ago"（绿色）
  - ⚠️ 未发帖：显示 "No posts yet"（橙色）
  - 灰色小字：上次检查时间

**操作按钮**：
- 🔄 **Refresh** - 刷新最后发帖时间（动画旋转）
- 🔵 **Enable/Disable** - 启用或禁用该小组
- 🗑️ **Delete** - 删除小组连接

**顶部工具栏**：
- 显示已连接小组总数
- 🔄 **Refresh** - 刷新整个列表

#### 使用流程

1. **连接小组**：
   ```
   小组会在连接Facebook账号时自动获取
   → 在OAuth页面选择要连接的小组
   → 完成连接
   ```

2. **查看最后发帖时间**：
   - 自动显示在小组卡片上
   - 绿色 = 已发帖
   - 橙色 = 未发帖

3. **刷新发帖时间**：
   ```
   点击小组卡片的 🔄 按钮
   → 系统连接 Facebook API
   → 获取该小组最新帖子
   → 找到你的最后一条帖子
   → 更新显示时间
   ```

4. **避免发帖过频**：
   - 查看"Last posted"时间
   - 如果太频繁，建议延后发帖
   - 维护小组活跃度的健康频率

#### 状态指示器
- ✅ **Last posted: X ago**（绿色）- 已发帖
- ⚠️ **No posts yet**（橙色）- 未发帖
- 🔵 **Active** - 小组已启用
- ⚪ **Inactive** - 小组已禁用

---

### 3️⃣ Publish to Facebook (发布到Facebook)

#### 功能概述
快速将 CMS 文章或自定义内容发布到 Facebook 页面或小组。

#### 界面元素

**表单字段**：

1. **Facebook Page**（下拉选择）
   - 显示所有已启用的页面
   - 格式：页面名称

2. **Post**（下拉选择 - 可选）
   - "Custom message"（自定义消息）
   - 或选择已发布的文章
   - 选择文章后自动填充消息

3. **Message**（文本框 - 必填）
   - 多行文本输入
   - 显示字符数统计
   - 支持换行和格式

4. **选项复选框**（仅当选择文章时显示）：
   - ☑️ **Include link to article** - 包含文章链接
   - ☑️ **Include cover image** - 包含封面图片
   - 如果文章没有封面图，该选项自动禁用

**操作按钮**：
- 📤 **Publish to Facebook** - 发布按钮
  - 显示 "Publishing..." 时带有加载动画
  - 成功后显示绿色成功消息
  - 失败后显示红色错误消息

#### 使用流程

**方式一：发布现有文章**
```
1. 选择 Facebook 页面
2. 从下拉菜单选择文章
3. 消息自动填充（标题 + 摘要）
4. 可以编辑消息内容
5. 选择是否包含链接和图片
6. 点击 "Publish to Facebook"
```

**方式二：自定义消息**
```
1. 选择 Facebook 页面
2. Post 选择保持 "Custom message"
3. 在消息框输入自定义内容
4. 点击 "Publish to Facebook"
```

#### 发布结果
- ✅ **成功** - 绿色提示框显示 "Successfully published to Facebook!"
- ❌ **失败** - 红色提示框显示错误原因

---

### 4️⃣ Publishing History (发布历史)

#### 功能概述
查看所有发布到 Facebook 的内容记录，追踪数据表现。

#### 界面元素

**帖子卡片显示**：

**顶部信息**：
- **状态徽章**：
  - 🟢 **PUBLISHED** - 已发布（绿色）
  - 🟡 **PENDING** - 待发布（黄色）
  - 🔴 **FAILED** - 发布失败（红色）
  - ⚪ **DELETED** - 已删除（灰色）
- **目标页面** - 发布到的页面名称
- **发布时间** - 例如："1/15/2025, 3:30 PM"

**帖子内容**：
- 发布的消息内容（最多显示2行）
- 如果关联了CMS文章，显示文章标题链接

**数据统计**（仅已发布的帖子）：
- 📈 **X likes** - 点赞数
- 🔄 **X shares** - 分享数
- 💬 **X comments** - 评论数
- 🔗 **View on Facebook** - 在Facebook查看链接

**错误信息**（失败的帖子）：
- 🔴 显示失败原因

**操作按钮**：
- 🔄 **Refresh** - 刷新数据统计（仅已发布的帖子）
- 🗑️ **Delete** - 删除记录（同时删除Facebook上的帖子）

**顶部工具栏**：
- 显示总发布数量
- 🔄 **Refresh** - 刷新整个列表

#### 使用流程

1. **查看发布记录**：
   - 自动按时间倒序显示
   - 查看发布状态和数据

2. **刷新数据统计**：
   ```
   点击帖子的 🔄 按钮
   → 从 Facebook API 获取最新数据
   → 更新点赞、分享、评论数
   ```

3. **删除发布记录**：
   ```
   点击 🗑️ 删除按钮
   → 确认删除
   → 从 Facebook 删除帖子（如果已发布）
   → 从系统删除记录
   ```

---

## 🔐 OAuth 授权流程

### 授权页面 (`/admin/facebook/callback`)

当点击 "Connect Facebook Page" 时，会打开新窗口显示授权页面。

#### 页面布局

**标题**：
```
Select Facebook Pages & Groups
Choose which Facebook pages and groups you want to connect to your CMS
```

#### 两个区域

**1. Pages (页面区域)**
- 显示所有你管理的Facebook页面
- 每个页面显示：
  - ☑️ 复选框
  - 页面名称
  - Page ID

**2. Groups (小组区域)**
- 显示所有你加入的Facebook小组
- 每个小组显示：
  - ☑️ 复选框
  - 小组名称
  - Group ID
  - 隐私级别徽章
  - 成员数量

#### 操作

**底部按钮**：
```
Connect X Items
```
- X = 选中的页面数 + 小组数
- 按钮在未选择任何项时禁用
- 点击后显示 "Connecting..." 动画

**连接流程**：
```
1. 选择要连接的页面和/或小组
2. 点击 "Connect X Items"
3. 系统保存连接信息
4. 显示成功消息
5. 2秒后自动关闭窗口
6. 主页面自动刷新显示新连接
```

---

## 🎨 UI 设计特点

### 颜色系统

**状态颜色**：
- 🟢 绿色 - 成功、已启用、已发布
- 🟡 黄色 - 待处理、警告
- 🔴 红色 - 失败、错误
- 🔵 蓝色 - 主要操作、Facebook品牌色
- ⚪ 灰色 - 已禁用、已删除

**隐私级别颜色**：
- 🟢 PUBLIC - 绿色
- 🟡 CLOSED - 黄色
- 🔴 SECRET - 红色

### 图标系统

- 📄 `Facebook` - Facebook页面图标
- 👥 `Users` - 小组图标
- 🔄 `RefreshCw` - 刷新图标
- 🗑️ `Trash2` - 删除图标
- 📤 `Send` - 发送图标
- ⏰ `Clock` - 时间图标
- 📈 `TrendingUp` - 数据统计图标
- 🔗 `ExternalLink` - 外部链接图标
- ⚠️ `AlertCircle` - 警告图标
- ✅ `CheckCircle` - 成功图标
- ⏳ `Loader2` - 加载动画

### 响应式设计

- **桌面端** - 完整显示所有信息
- **平板** - 自适应布局
- **手机** - 堆叠式卡片，优化触摸操作

### 交互反馈

**按钮状态**：
- 默认 - 正常显示
- Hover - 背景色变化
- Active - 按下效果
- Disabled - 灰色且不可点击
- Loading - 旋转动画

**加载状态**：
- 列表加载 - 显示 "Loading..."
- 操作进行中 - 按钮显示动画
- 刷新中 - 图标旋转

**提示消息**：
- ✅ 成功 - 绿色横幅，自动消失
- ❌ 错误 - 红色横幅，需手动关闭
- ⚠️ 警告 - 黄色横幅

---

## 📱 移动端优化

### 触摸优化
- 所有按钮最小 44x44px 触摸区域
- 卡片间距增大，避免误触
- 下拉菜单自适应移动端

### 布局调整
- 卡片堆叠显示
- 操作按钮垂直排列
- 表单字段全宽显示

---

## ⌨️ 键盘快捷键

当前不支持键盘快捷键，但建议未来添加：
- `Ctrl/Cmd + Enter` - 发布内容
- `Ctrl/Cmd + R` - 刷新列表
- `ESC` - 关闭对话框

---

## 🔔 通知系统

### 成功通知
- ✅ 连接成功
- ✅ 发布成功
- ✅ 刷新成功
- ✅ 删除成功

### 错误通知
- ❌ Token 过期
- ❌ 网络错误
- ❌ 权限不足
- ❌ 发布失败

### 警告通知
- ⚠️ Token 即将过期
- ⚠️ 删除确认
- ⚠️ 发帖频率过高建议

---

## 💡 最佳实践

### 小组发帖频率
1. 使用"最后发帖时间"功能
2. 建议间隔至少24小时
3. 避免在同一小组连续发帖
4. 根据小组规则调整频率

### 页面管理
1. 定期检查Token过期时间
2. 及时重新连接过期的页面
3. 禁用不常用的页面，保持列表整洁

### 内容发布
1. 预览消息内容
2. 检查链接和图片
3. 选择合适的发布时间
4. 发布后监控数据表现

---

## 🐛 常见问题

### Q: 为什么看不到小组？
A: 小组功能需要特殊权限（`groups_access_member_info`），可能需要Facebook应用审核。在开发模式下可以测试。

### Q: 如何刷新最后发帖时间？
A: 点击小组卡片右侧的 🔄 按钮，系统会自动从Facebook获取最新数据。

### Q: Token过期了怎么办？
A: 删除旧连接，重新点击"Connect Facebook Page"按钮连接。

### Q: 可以同时发布到多个页面吗？
A: 当前版本需要逐个发布。未来可能添加批量发布功能。

### Q: 删除发布记录会删除Facebook上的帖子吗？
A: 是的，删除操作会同时删除系统记录和Facebook上的帖子。

---

## 🎯 功能路线图

### 即将推出
- [ ] 定时发布功能
- [ ] 批量发布到多个页面/小组
- [ ] 发帖日历视图
- [ ] 数据分析仪表板
- [ ] 自动发帖建议（基于最佳时间）
- [ ] 小组发帖频率提醒

### 考虑中
- [ ] Instagram集成
- [ ] Twitter/X集成
- [ ] 内容模板系统
- [ ] A/B测试功能
- [ ] 评论管理功能

---

## 📞 技术支持

如有问题或建议，请：
1. 查看本文档
2. 查看 `docs/FACEBOOK_INTEGRATION.md` 技术文档
3. 检查浏览器控制台错误信息
4. 提交 GitHub Issue

---

**版本**: 1.0.0
**最后更新**: 2025-01-13
**适用于**: AI CMS Facebook 集成模块
